name: Lint

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  commit-lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Check Commit Messages
        uses: wagoid/commitlint-github-action@v5

  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 1. Markdown Linting
      - name: Lint Markdown
        uses: DavidAnson/markdownlint-cli2-action@v16
        with:
          config: '.github/linters/.markdownlint.json'
          globs: '**/*.md'

      # 2. JSON/TOML Linting (Biome)
      - name: Lint JSON & Metadata
        run: |
          npx @biomejs/biome ci .

      # 3. Specialized Arma Checkers
      - name: Validate Config
        run: |
          CHECKER=".uksf_tools/tools/config_style_checker.py"
          if [ ! -f "$CHECKER" ]; then CHECKER="tools/config_style_checker.py"; fi
          python3 "$CHECKER"

      - name: Validate Stringtables
        run: CHECKER=".uksf_tools/tools/stringtable_validator.py"; if [ ! -f "$CHECKER" ]; then CHECKER="tools/stringtable_validator.py"; fi; python3 "$CHECKER"

      - name: Validate SQF
        run: CHECKER=".uksf_tools/tools/sqf_validator.py"; if [ ! -f "$CHECKER" ]; then CHECKER="tools/sqf_validator.py"; fi; python3 "$CHECKER"

      - name: Validate Return Types
        run: CHECKER=".uksf_tools/tools/return_checker.py"; if [ ! -f "$CHECKER" ]; then CHECKER="tools/return_checker.py"; fi; python3 "$CHECKER"
