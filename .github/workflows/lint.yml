name: Lint

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  commit-lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Check Commit Messages
        uses: wagoid/commitlint-github-action@v5

  validate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Validate Config
        run: |
          CHECKER=".uksf_tools/tools/config_style_checker.py"
          if [ ! -f "$CHECKER" ]; then CHECKER="tools/config_style_checker.py"; fi
          python3 "$CHECKER"

      - name: Validate Stringtables
        run: CHECKER=".uksf_tools/tools/stringtable_validator.py"; if [ ! -f "$CHECKER" ]; then CHECKER="tools/stringtable_validator.py"; fi; python3 "$CHECKER"

      - name: Validate SQF
        run: CHECKER=".uksf_tools/tools/sqf_validator.py"; if [ ! -f "$CHECKER" ]; then CHECKER="tools/sqf_validator.py"; fi; python3 "$CHECKER"

      - name: Validate Return Types
        run: CHECKER=".uksf_tools/tools/return_checker.py"; if [ ! -f "$CHECKER" ]; then CHECKER="tools/return_checker.py"; fi; python3 "$CHECKER"

      - name: Validate Unused Variables
        run: CHECKER=".uksf_tools/tools/search_unused_privates.py"; if [ ! -f "$CHECKER" ]; then CHECKER="tools/search_unused_privates.py"; fi; python3 "$CHECKER"
